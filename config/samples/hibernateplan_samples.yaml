---
# Example: CloudProvider for AWS
apiVersion: hibernator.ardikabs.com/v1alpha1
kind: CloudProvider
metadata:
  name: aws-production
  namespace: hibernator-system
spec:
  type: aws
  aws:
    accountId: "123456789012"
    region: us-west-2
    assumeRoleArn: arn:aws:iam::123456789012:role/HibernatorRole
    auth:
      serviceAccount: {}
---
# Example: K8SCluster for EKS
apiVersion: hibernator.ardikabs.com/v1alpha1
kind: K8SCluster
metadata:
  name: eks-production
  namespace: hibernator-system
spec:
  providerRef:
    name: aws-production
  eks:
    name: production-cluster
    region: us-west-2
---
# Example: HibernatePlan with DAG strategy
apiVersion: hibernator.ardikabs.com/v1alpha1
kind: HibernatePlan
metadata:
  name: production-hibernate
  namespace: hibernator-system
spec:
  schedule:
    timezone: America/Los_Angeles
    offHours:
      - start: "20:00"
        end: "06:00"
        daysOfWeek: ["MON", "TUE", "WED", "THU", "FRI"]

  execution:
    strategy:
      type: DAG
      maxConcurrency: 3
      dependencies:
        # Karpenter nodes first, then EKS managed node groups
        - from: eks-karpenter
          to: eks-nodegroups
        # Frontend depends on backend
        - from: frontend-asg
          to: backend-asg
        # Backend depends on database
        - from: backend-asg
          to: database-rds
        # Worker depends on database
        - from: worker-asg
          to: database-rds

  targets:
    # EKS Managed Node Groups (via AWS API)
    - name: eks-nodegroups
      type: eks
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        clusterName: production-cluster
        nodeGroups:
          - name: app-nodes
          - name: worker-nodes

    # Karpenter NodePools (via Kubernetes API)
    - name: eks-karpenter
      type: karpenter
      connectorRef:
        kind: K8SCluster
        name: eks-production
      parameters:
        nodePools: []  # empty means all NodePools

    # RDS database
    - name: database-rds
      type: rds
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        instanceId: production-db
        snapshotBeforeStop: true

    # Frontend ASG (via EC2 instances)
    - name: frontend-asg
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        selector:
          tags:
            Environment: production
            Component: frontend

    # Backend ASG
    - name: backend-asg
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        selector:
          tags:
            Environment: production
            Component: backend

    # Worker ASG
    - name: worker-asg
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        selector:
          tags:
            Environment: production
            Component: worker

  behavior:
    mode: BestEffort
    failFast: false
    retries: 3
---
# Example: HibernatePlan with Staged strategy
apiVersion: hibernator.ardikabs.com/v1alpha1
kind: HibernatePlan
metadata:
  name: dev-hibernate-staged
  namespace: hibernator-system
spec:
  schedule:
    timezone: UTC
    offHours:
      - start: "18:00"
        end: "08:00"
        daysOfWeek: ["MON", "TUE", "WED", "THU", "FRI"]

  execution:
    strategy:
      type: Staged
      stages:
        - name: frontend-tier
          parallel: true
          maxConcurrency: 2
          targets:
            - frontend-web
            - frontend-api
        - name: backend-tier
          parallel: true
          maxConcurrency: 2
          targets:
            - backend-service
            - worker-service
        - name: data-tier
          parallel: false
          targets:
            - cache-redis
            - database

  targets:
    - name: frontend-web
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        selector:
          tags:
            Name: dev-frontend-web

    - name: frontend-api
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        selector:
          tags:
            Name: dev-frontend-api

    - name: backend-service
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        selector:
          tags:
            Name: dev-backend

    - name: worker-service
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        selector:
          tags:
            Name: dev-worker

    - name: cache-redis
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        selector:
          tags:
            Name: dev-redis

    - name: database
      type: rds
      connectorRef:
        kind: CloudProvider
        name: aws-production
      parameters:
        instanceId: dev-database

  behavior:
    mode: Strict
    failFast: true
    retries: 2
---
# Example: Simple Sequential HibernatePlan
apiVersion: hibernator.ardikabs.com/v1alpha1
kind: HibernatePlan
metadata:
  name: simple-sequential
  namespace: default
spec:
  schedule:
    timezone: UTC
    offHours:
      - start: "22:00"
        end: "07:00"
        daysOfWeek: ["MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN"]

  execution:
    strategy:
      type: Sequential

  targets:
    - name: app-instances
      type: ec2
      connectorRef:
        kind: CloudProvider
        name: aws-production
        namespace: hibernator-system
      parameters:
        selector:
          instanceIds:
            - i-0123456789abcdef0
            - i-0123456789abcdef1

    - name: app-database
      type: rds
      connectorRef:
        kind: CloudProvider
        name: aws-production
        namespace: hibernator-system
      parameters:
        instanceId: simple-app-db

  behavior:
    mode: BestEffort

---
# Example: HibernatePlan with WorkloadScaler executor
apiVersion: hibernator.ardikabs.com/v1alpha1
kind: HibernatePlan
metadata:
  name: workload-scaler-plan
  namespace: hibernator-system
spec:
  schedule:
    timezone: America/New_York
    offHours:
      - start: "20:00"
        end: "06:00"
        daysOfWeek: ["MON", "TUE", "WED", "THU", "FRI"]

  execution:
    strategy:
      type: Sequential

  targets:
    - name: scale-deployments
      type: workloadscaler
      connectorRef:
        kind: K8SCluster
        name: eks-production
        namespace: hibernator-system
      parameters:
        includedGroups:
          - Deployment
          - StatefulSet
        namespace:
          literals:
            - app-team-a
            - app-team-b
        workloadSelector:
          matchLabels:
            app.kubernetes.io/part-of: payments

  behavior:
    mode: Strict
