---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: hibernateplans.hibernator.ardikabs.com
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.0
spec:
  group: hibernator.ardikabs.com
  names:
    kind: HibernatePlan
    listKind: HibernatePlanList
    plural: hibernateplans
    singular: hibernateplan
    shortNames:
      - hp
      - hplan
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Strategy
          type: string
          jsonPath: .spec.execution.strategy.type
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          type: object
          required:
            - spec
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              required:
                - schedule
                - targets
              properties:
                schedule:
                  type: object
                  required:
                    - hibernate
                    - wakeUp
                  properties:
                    timezone:
                      type: string
                      default: "UTC"
                    hibernate:
                      type: string
                    wakeUp:
                      type: string
                execution:
                  type: object
                  properties:
                    strategy:
                      type: object
                      required:
                        - type
                      properties:
                        type:
                          type: string
                          enum:
                            - Sequential
                            - Parallel
                            - DAG
                            - Staged
                        maxConcurrency:
                          type: integer
                          format: int32
                          minimum: 1
                        dependencies:
                          type: array
                          items:
                            type: object
                            required:
                              - from
                              - to
                            properties:
                              from:
                                type: string
                              to:
                                type: string
                        stages:
                          type: array
                          items:
                            type: object
                            required:
                              - name
                              - targets
                            properties:
                              name:
                                type: string
                              parallel:
                                type: boolean
                                default: false
                              maxConcurrency:
                                type: integer
                                format: int32
                                minimum: 1
                              targets:
                                type: array
                                items:
                                  type: string
                targets:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - name
                      - type
                      - connectorRef
                    properties:
                      name:
                        type: string
                      type:
                        type: string
                      connectorRef:
                        type: object
                        required:
                          - kind
                          - name
                        properties:
                          kind:
                            type: string
                            enum:
                              - CloudProvider
                              - K8SCluster
                          name:
                            type: string
                          namespace:
                            type: string
                      parameters:
                        type: object
                        x-kubernetes-preserve-unknown-fields: true
                behavior:
                  type: object
                  properties:
                    mode:
                      type: string
                      enum:
                        - Strict
                        - BestEffort
                      default: BestEffort
                    failFast:
                      type: boolean
                      default: false
                    retries:
                      type: integer
                      format: int32
                      minimum: 0
                      default: 3
            status:
              type: object
              properties:
                phase:
                  type: string
                  enum:
                    - Pending
                    - Active
                    - Hibernating
                    - Hibernated
                    - WakingUp
                    - Error
                observedGeneration:
                  type: integer
                  format: int64
                lastTransitionTime:
                  type: string
                  format: date-time
                executions:
                  type: array
                  items:
                    type: object
                    properties:
                      target:
                        type: string
                      executor:
                        type: string
                      state:
                        type: string
                        enum:
                          - Pending
                          - Running
                          - Completed
                          - Failed
                          - Skipped
                      startedAt:
                        type: string
                        format: date-time
                      finishedAt:
                        type: string
                        format: date-time
                      attempts:
                        type: integer
                        format: int32
                      jobRef:
                        type: string
                      restoreRef:
                        type: string
                conditions:
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                      reason:
                        type: string
                      message:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: cloudproviders.hibernator.ardikabs.com
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.0
spec:
  group: hibernator.ardikabs.com
  names:
    kind: CloudProvider
    listKind: CloudProviderList
    plural: cloudproviders
    singular: cloudprovider
    shortNames:
      - cp
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Type
          type: string
          jsonPath: .spec.type
        - name: Region
          type: string
          jsonPath: .spec.aws.region
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          type: object
          required:
            - spec
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              required:
                - type
              properties:
                type:
                  type: string
                  enum:
                    - AWS
                    - GCP
                    - Azure
                aws:
                  type: object
                  required:
                    - region
                    - auth
                  properties:
                    region:
                      type: string
                    assumeRoleARN:
                      type: string
                    auth:
                      type: object
                      properties:
                        type:
                          type: string
                          enum:
                            - ServiceAccount
                            - Static
                        serviceAccount:
                          type: object
                          properties:
                            name:
                              type: string
                            namespace:
                              type: string
                            roleARN:
                              type: string
                        static:
                          type: object
                          properties:
                            secretRef:
                              type: object
                              required:
                                - name
                              properties:
                                name:
                                  type: string
                                namespace:
                                  type: string
            status:
              type: object
              properties:
                ready:
                  type: boolean
                conditions:
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                      reason:
                        type: string
                      message:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: k8sclusters.hibernator.ardikabs.com
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.0
spec:
  group: hibernator.ardikabs.com
  names:
    kind: K8SCluster
    listKind: K8SClusterList
    plural: k8sclusters
    singular: k8scluster
    shortNames:
      - kc
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Type
          type: string
          jsonPath: .spec.type
        - name: Cluster
          type: string
          jsonPath: .spec.clusterName
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          type: object
          required:
            - spec
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              required:
                - type
                - clusterName
              properties:
                type:
                  type: string
                  enum:
                    - EKS
                    - GKE
                    - AKS
                    - Generic
                clusterName:
                  type: string
                eks:
                  type: object
                  required:
                    - region
                  properties:
                    region:
                      type: string
                    providerRef:
                      type: object
                      required:
                        - name
                      properties:
                        name:
                          type: string
                        namespace:
                          type: string
                gke:
                  type: object
                  required:
                    - projectID
                  properties:
                    projectID:
                      type: string
                    zone:
                      type: string
                    providerRef:
                      type: object
                      required:
                        - name
                      properties:
                        name:
                          type: string
                        namespace:
                          type: string
                access:
                  type: object
                  properties:
                    kubeconfigSecretRef:
                      type: object
                      required:
                        - name
                      properties:
                        name:
                          type: string
                        namespace:
                          type: string
                        key:
                          type: string
                          default: kubeconfig
            status:
              type: object
              properties:
                ready:
                  type: boolean
                conditions:
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                        enum:
                          - "True"
                          - "False"
                          - Unknown
                      reason:
                        type: string
                      message:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
